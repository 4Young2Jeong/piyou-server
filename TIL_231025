# Bazelì„ ì´ìš©í•œ MediaPipeì˜ jar ë° apk ë¹Œë“œ ë°©ë²•

1. homebrewë¥¼ ì´ìš©í•´ bazelì„ ì„¤ì¹˜í•œë‹¤.
    
    ```
    brew install --cask bazel
    ```
    
2. android sdkì™€ ndkë¥¼ ì„¤ì¹˜í•œë‹¤.
    
    <aside>
    ğŸ’¡ êµ¬ê¸€ í”Œë ˆì´ ìŠ¤í† ì–´ì— ì—…ë¡œë“œ í•˜ë ¤ë©´ íƒ€ì¼“ apiê°€ 33ì´ì–´ì•¼í•œë‹¤.(33ë²„ì „)
    homebrewë¡œ ì„¤ì¹˜í•˜ë©´ 29ë²„ì „ì´ ì„¤ì¹˜ë˜ê³  ê·¸ ë§ˆì €ë„ ì œëŒ€ë¡œ ì„¤ì¹˜ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— Android Developerë¡œ ë“¤ì–´ê°€ì„œ command line tool ì„¤ì¹˜ë¥¼ í†µí•´ 33ë²„ì „ì„ ì„¤ì¹˜í•˜ì.
    ë˜í•œ Bazelì´ Android SDKì˜ ë¹Œë“œ ë„êµ¬ ë²„ì „ì„ í™•ì¸í–ˆì„ë•Œ í•„ìš” ë²„ì „ì´ 30.0.0 ì´ìƒì´ë‹¤.
    
    </aside>
    
    <aside>
    ğŸ’¡ ì—¬ê¸°ì„œëŠ” ì¡°ê¸ˆ í‹€ë ¸ì§€ë§Œ, ê·¸ ê³¼ì •ì„ ê·¸ëŒ€ë¡œ ë‚¨ê²¨ ë†“ëŠ”ë‹¤.
    í˜„ì¬ëŠ” ë¹Œë“œê°€ ë˜ë‹ˆê¹Œ í˜„ ìƒíƒœë¥¼ ê·¸ëŒ€ë¡œ ë†“ê³ , í™˜ê²½ ë³€ìˆ˜ë“¤ì„ ë°”ê¾¸ëŠ” ê²ƒì€ í•˜ë‹¨ì—ì„œ ë³„ë„ë¡œ ì§„í–‰í•˜ê² ë‹¤.
    
    </aside>
    
    - ndk ì„¤ì¹˜ ë° í™˜ê²½ë³€ìˆ˜ ì„¤ì •
        
        <aside>
        ğŸ’¡ homebrewë¡œ ì„¤ì¹˜í•˜ë©´ ê°€ì¥ ìµœì‹ ë²„ì „ì´ ì„¤ì¹˜ë˜ì–´ì„œ mediapipeë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
        ë°˜ë“œì‹œ android githubë¡œ ë“¤ì–´ê°€ ì§€ì›í•˜ëŠ” ë²„ì „ìœ¼ë¡œ ì„¤ì¹˜í•˜ì.
        
        </aside>
        
        1. ndkëŠ” 20ë²„ì „(`android-ndk-r20b-drawin-x86_64.zip`)ì„ ë‹¤ìš´ë°›ëŠ”ë‹¤. (ì•„ë˜ ë§í¬)
            
            [Unsupported Downloads](https://github.com/android/ndk/wiki/Unsupported-Downloads)
            
            [](https://dl.google.com/android/repository/android-ndk-r20b-darwin-x86_64.zip)
            
        2. ì••ì¶•ì„ í•´ì œí•œë‹¤.
            
            ë‚˜ëŠ” ê·¸ëƒ¥ í•´ì œí•´ì„œ `/Users/choehayoung/Downloads/android-ndk-r20b` ì— ì••ì¶•ì„ í’€ì—ˆë‹¤.
            
        3. ì´ì œ ì € ìœ„ì¹˜ì— ìˆëŠ” ndkë¥¼ í™˜ê²½ë³€ìˆ˜ì— ì¶”ê°€í•´ì¤€ë‹¤.
        4. `open ~/.zshrc` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ `.zshrc` íŒŒì¼ì„ ì—°ë‹¤.
        5. `.zshrc` íŒŒì¼ì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•´ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•œë‹¤.
            
            ```
            export ANDROID_NDK_HOME=/Users/choehayoung/Downloads/android-ndk-r20b
            ```
            
        6. cmd + sëŠ˜ ëˆŒëŸ¬ì„œ ì €ì¥í•˜ê³  ì°½ì„ ë‹«ëŠ”ë‹¤.
        7. source ~/.zshrcë¡œ ì ìš©ì‹œí‚¨ë‹¤.
        8. `echo $ANDROID_NDK_HOME` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ ì •ìƒì ìœ¼ë¡œ í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.
    - sdk ì„¤ì¹˜ ë° í™˜ê²½ë³€ìˆ˜ ì„¤ì •
        1. homebrewì—ì„œ `brew install android-sdk` ë¥¼ ì‚¬ìš©í•´ì„œ ì„¤ì¹˜í•œë‹¤.
        2. í•´ë‹¹ ê²½ë¡œ `opt/homebrew/share/android-sdk` ë¥¼ í™˜ê²½ë³€ìˆ˜ì— ë“±ë¡í•œë‹¤.
        3. `open ~/.zshrc` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ `.zshrc` íŒŒì¼ì„ ì—°ë‹¤.
        4. `.zshrc` íŒŒì¼ì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•´ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•œë‹¤.
            
            ```
            export ANDROID_HOME=/opt/homebrew/share/android-sdk
            export PATH=$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools
            ```
            
        5. cmd + sëŠ˜ ëˆŒëŸ¬ì„œ ì €ì¥í•˜ê³  ì°½ì„ ë‹«ëŠ”ë‹¤.
        6. source ~/.zshrcë¡œ ì ìš©ì‹œí‚¨ë‹¤.
        7. `echo $ANDROID_HOME` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ ì •ìƒì ìœ¼ë¡œ í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.
        8. `/opt/homebrew/sh/android-sdk` ê²½ë¡œë¡œ ê°€ë‹ˆ `tools` í´ë”ë§Œ ìƒì„±ë˜ì–´ ìˆë‹¤. ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆë‹¤ë©´ `build-tools` , `platforms` ë“± Android SDKì˜ ê¸°ë³¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°ê°€ ìƒì„±ë˜ì–´ì•¼í•œë‹¤. ë¹„ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆë‹¤.
        9. ë”°ë¼ì„œ Android developer ì‚¬ì´íŠ¸ì—ì„œ Command line tools only ì„¹ì…˜(í˜ì´ì§€ í•˜ë‹¨)ìœ¼ë¡œ ì´ë™í•´ì„œ Mac OS ìš© sdktools-darwinì„ ë‹¤ìš´ë°›ê³  ì••ì¶•ì„ í•´ì œí•œë‹¤.
            
            [Download Android Studio & App Tools - Android Developers](https://developer.android.com/studio)
            
        10. ë‚˜ëŠ” ê·¸ëƒ¥ í•´ì œí•´ì„œ `/Users/choehayoung/Downloads/cmdline-tools` ì— ìœ„ì¹˜í•´ìˆë‹¤.
        11. ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì´ìš©í•´ì„œ sdk ì„¤ì¹˜ ìœ„ì¹˜ë¡œ ì´ë™ì‹œí‚¨ë‹¤.
            
            ```
            mkdir -p $ANDROID_HOME/cmdline-tools/latest
            mv /Users/cheohayoung/Dowmloads/cmdline-tools/* $ANDROID_HOME/cmdline-tools/latest/
            ```
            
        12. sdkmanagerë¡œ ì„¤ì¹˜(ì´ ë¶€ë¶„ì€ ê¸°ì–µì´ í™•ì‹¤ì¹˜ ì•Šë‹¤.)
            
            ```
            sdkmanager â€œplatform-toolsâ€ â€œplatforms;android-30â€
            sdkmanager â€œbuild-tools;30.0.3â€
            ```
            
3. mediapipe ê°€ì ¸ì˜¤ê¸°
    
    ```
    git clone https://github.com/google/mediapipe.git
    ```
    
4. `/Users/choehayoung/mediapipe/mediapipe/examples/android/src/java/com/google/mediapipe/apps/holistictrackinggpu/BUILD` ì˜ BUILD íŒŒì¼ì„ ìˆ˜ì •í•´ì¤€ë‹¤(ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.)
    - BUILD
        
        ```
        android_binary(
            name = "holistictrackinggpu",
            srcs = glob(["*.java"]),
            assets = [
                "//mediapipe/graphs/holistic_tracking:holistic_tracking_gpu.binarypb",
                "//mediapipe/modules/face_detection:face_detection_short_range.tflite",
                "//mediapipe/modules/face_landmark:face_landmark.tflite",
                "//mediapipe/modules/hand_landmark:hand_landmark_full.tflite",
                "//mediapipe/modules/hand_landmark:hand_landmark_lite.tflite",
                "//mediapipe/modules/hand_landmark:handedness.txt",
                "//mediapipe/modules/holistic_landmark:hand_recrop.tflite",
                "//mediapipe/modules/pose_detection:pose_detection.tflite",
                "//mediapipe/modules/pose_landmark:pose_landmark_full.tflite",
            ],
            assets_dir = "",
            manifest = "//mediapipe/examples/android/src/java/com/google/mediapipe/apps/basic:AndroidManifest.xml",
            manifest_values = {
                "applicationId": "com.google.mediapipe.apps.holistictrackinggpu",
                "appName": "Holistic Tracking",
                "mainActivity": "com.google.mediapipe.apps.basic.MainActivity",
                "cameraFacingFront": "False",
                "binaryGraphName": "holistic_tracking_gpu.binarypb",
                "inputVideoStreamName": "input_video",
                "outputVideoStreamName": "output_video",
                "flipFramesVertically": "True",
                "converterNumBuffers": "3",
            },
            multidex = "native",
            deps = [
                ":mediapipe_jni_lib",
                "//mediapipe/examples/android/src/java/com/google/mediapipe/apps/basic:basic_lib",
                "//mediapipe/framework/formats:landmark_java_proto_lite",
                "//mediapipe/java/com/google/mediapipe/framework:android_framework",
            ],
        )
        
        android_library(
            name = "holistictrackinggpu_lib",
            srcs = glob(["*.java"]),
            manifest = "//mediapipe/examples/android/src/java/com/google/mediapipe/apps/basic:AndroidManifest.xml",
            deps = [
                ":mediapipe_jni_lib",
                "//mediapipe/examples/android/src/java/com/google/mediapipe/apps/basic:basic_lib",
                "//mediapipe/framework/formats:landmark_java_proto_lite",
                "//mediapipe/java/com/google/mediapipe/framework:android_framework",
            ],
        )
        ```
        
5. /`Users/choehayoung/mediapipe/WORKSPACE` ì˜ WORKSPACE íŒŒì¼ì„ ìˆ˜ì •í•´ì¤€ë‹¤(ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.)
    - WORKSPACE
        
        ```
        android_ndk_repository(
            name = "androidndk",
            path = "/Users/choehayoung/Downloads/android-ndk-r20b", # ANDROID_HOME í™˜ê²½ ë³€ìˆ˜ì˜ ê°’ìœ¼ë¡œ ë³€ê²½.
            api_level = 20,
        )
        
        android_sdk_repository(
            name = "androidsdk",
            path = "/opt/homebrew/share/android-sdk", # ANDROID_HOME í™˜ê²½ ë³€ìˆ˜ì˜ ê°’ìœ¼ë¡œ ë³€ê²½.
            api_level = 33,
            build_tools_version = "33.0.0"
        )
        ```
        
6. ì—¬ê¸°ì„œ WORKSPACE ë‚´ì˜ ë²„ì „ê³¼ ì‹¤ì œ ì„¤ì¹˜ë˜ì–´ ìˆëŠ” ë²„ì „ ì‹¤ì œ ìœ„ì¹˜ì™€ í™˜ê²½ë³€ìˆ˜ ëª¨ë“ ê²Œ ì¼ì¹˜í•´ì•¼í•œë‹¤.
7. `/Users/choehayoung/mediapipe` ê²½ë¡œì—ì„œ ì•„ë˜ ì½”ë“œë¥¼ ì‹¤í–‰í•œë‹¤.
    - bazel ëª…ë ¹ì–´
        
        ```
        bazel build -c opt --config=android_arm64 //mediapipe/examples/android/src/java/com/google/mediapipe/apps/holistictrackinggpu:holistictrackinggpu
        ```
        
    
    ìœ„ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ BUILD íŒŒì¼ì— ì •ì˜í•´ë†“ì€ android-binaryê°€ ì‹¤í–‰ëœë‹¤.
    
8. `/private/var/tmp/_bazel_choehayoung/0aca2b8ad635071449e45a40b0a8c720/execroot/mediapipe/bazel-out/arm64-v8a-opt/bin/mediapipe/examples/android/src/java/com/google/mediapipe/apps/holistictrackinggpu` ê²½ë¡œì— ì‚°ì¶œë¬¼ì´ ìƒì„±ëœë‹¤.(jar, apk)

---

# ì˜¤ë¥˜

- JDK ë²„ì „ ì˜¤ë¥˜
    - ì˜¤ë¥˜ì½”ë“œ
        
        ```
        â¯ sdkmanager --list
        
        Exception in thread "main" java.lang.NoClassDefFoundError: javax/xml/bind/annotation/XmlSchema
        at com.android.repository.api.SchemaModule$SchemaModuleVersion.<init>(SchemaModule.java:156)
        at com.android.repository.api.SchemaModule.<init>(SchemaModule.java:75)
        at com.android.sdklib.repository.AndroidSdkHandler.<clinit>(AndroidSdkHandler.java:81)
        at com.android.sdklib.tool.sdkmanager.SdkManagerCli.main(SdkManagerCli.java:73)
        at com.android.sdklib.tool.sdkmanager.SdkManagerCli.main(SdkManagerCli.java:48)
        Caused by: java.lang.ClassNotFoundException: javax.xml.bind.annotation.XmlSchema
        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:641)
        at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188)
        at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:525)
        ... 5 more
        ```
        
    
    ì›ì¸: J**ava 9 ì´ìƒì˜ ë²„ì „ì—ì„œ `javax.xml.bind.annotation.XmlSchema` í´ë˜ìŠ¤ê°€ ë” ì´ìƒ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë°œìƒ**
    
    í•´ê²°: zulu jdk 8 ì„¤ì¹˜ í›„ í™˜ê²½ë³€ìˆ˜ ì„¤ì •
    
- Xcode ì„¤ì¹˜ ì˜¤ë¥˜
    - ì˜¤ë¥˜ì½”ë“œ
        
        **ERROR: /private/var/tmp/_bazel_choehayoung/0aca2b8ad635071449e45a40b0a8c720/external/bazel_tools/tools/android/BUILD:440:12: @bazel_tools//tools/android:databinding_exec depends on @local_config_apple_cc//:cc-compiler-darwin_arm64 in repository @local_config_apple_cc which failed to fetch. no such package '@local_config_apple_cc//': Failed to configure Apple CC toolchain, if you only have the command line tools installed and not Xcode, you cannot use this toolchain. You should either remove it or temporarily set 'BAZEL_NO_APPLE_CPP_TOOLCHAIN=1' in the environment
        ERROR: Analysis of target '//mediapipe/examples/android/src/java/com/google/mediapipe/apps/handtrackinggpu:handtrackinggpu' failed; build aborted:
        INFO: Elapsed time: 17.158s
        INFO: 0 processes.
        FAILED: Build did NOT complete successfully (85 packages loaded, 7757**
        
        **targets configured)
        currently loading: @org_tensorflow//tensorflow/lite
        Fetching ...lite?generation=1661875766398729; 966.7 KiB (989,902B)
        Fetching ...lite?generation=1661875760968579; 864.0 KiB (884,768B)
        Fetching ...lite?generation=1661875885885770; 1.3 MiB (1,398,132B)
        Fetching ...lite?generation=1662745358034050; 1.4 MiB (1,450,016B)
        Fetching .../java/v11.9/java_tools-v11.9.zip; 266.7 KiB (273,072B)
        Fetching**
        
        **[https://mirror.bazel.build/...oid_tools_pkg-0.27.0.tar.gz](https://mirror.bazel.build/...oid_tools_pkg-0.27.0.tar.gz)**
        
        **Fetching**
        
        **[https://github.com/.../download/v2.0.7/coursier.jar](https://github.com/.../download/v2.0.7/coursier.jar)**
        
        **Fetching**
        
        **[https://mirror.bazel.build/....0.15-macosx_aarch64.tar.gz](https://mirror.bazel.build/....0.15-macosx_aarch64.tar.gz)**
        
    
    ì›ì¸: Xcode command lineë§Œ ì„¤ì¹˜ë˜ì—ˆê³  XcodeëŠ” ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸
    
    í•´ê²°: Mac OSë¥¼ 14.1(23B73)ë¡œ ì—…ë°ì´íŠ¸ í›„ í™ˆí˜ì´ì§€ì—ì„œ Xcode 15.0.1 ì„¤ì¹˜
